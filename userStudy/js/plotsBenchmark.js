function plotContinueStack(t,e){var a=t.stackedDataArr[e],n=a.xScale,r=a.yScale,o=t.color,s=t.svg,i=t.height,c=t.stackProcess,l=t.totalXRange,d=a.stackedData,u=a.endPoint;if(s.selectAll(".continueStack"+e).remove(),0!=d.length){d3.select("#continueStack").style("height",u+50+"px"),d3.select(".toolTipContinue"+e).empty()&&d3.select("body").append("div").attr("class","tooltip toolTipContinue toolTipContinue"+e).style("opacity",0);var p=d3.select(".toolTipContinue"+e);if(0==d.length)return s.selectAll(".continueGraph"+e).remove(),void s.selectAll(".yAxisContinue"+e).remove();var y=d3.svg.area().interpolate(interpolate).x(function(t){return n(t.x)}).y0(function(t){return r(t.display.y0)}).y1(function(t){return r(t.display.y+t.display.y0)});d=c(d);var g=d3.behavior.drag().on("drag",function(t){t.drag.x+=d3.event.dx,t.drag.y+=d3.event.dy,d3.select(this).classed("unselected",!1).attr("transform",function(t){return"translate("+[t.drag.x,t.drag.y]+")"}),d3.event.sourceEvent.stopPropagation()}).on("dragend",function(a){console.log(d3.mouse(this),a.drag.x,a.drag.y),orderAndPartition(t,d3.mouse(this),e,a),a.drag.x=0,a.drag.y=0});d3.selectAll(".yAxisContinue"+e).empty()&&s.append("g").attr("class","y axis yAxis yAxisContinue"+e).call(a.yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").text("Aggregation"),d3.selectAll(".xAxisContinue").empty()&&s.append("g").attr("class","x axis xAxis xAxisContinue").attr("transform","translate(0,"+i/2+")").call(a.xAxis),s.selectAll(".continueStack"+e).empty()?s.selectAll(".continueStack"+e).data(d).enter().append("path").attr("class",function(t){return"continueStack continueStack"+e+" continue-"+e+"-sequence-"+t.lineContent.slice(1)+" continueGraph"+e}):path.data(d).attr("class",function(t){return"continueStack continueStack"+e+" continue-"+e+"-sequence-"+t.lineContent.slice(1)+" continueGraph"+e}),s.selectAll(".continueStack"+e).attr("d",function(t){return y(t.values)}).style("fill",function(t){return o(t)}).on("mouseover",function(t){d3.selectAll(".continue-"+e+"-sequence-"+t.lineContent.slice(1)).classed("hover",!0),p.transition().duration(200).style("opacity",toolTipOp),p.html(t.lineContent).style("left",d3.event.pageX+5+"px").style("top",d3.event.pageY+10+"px").style("text-align","center").style("font-weight",600)}).on("mouseout",function(t){d3.selectAll(".continue-"+e+"-sequence-"+t.lineContent.slice(1)).classed("hover",!1),p.transition().duration(500).style("opacity",0)}).on("dblclick",function(a,n){changeBase(t,n,e)}).call(g),d3.selectAll(".brushNoticeContinue"+e).remove(),d3.selectAll(".brushNoticeContinue"+e).empty()&&s.append("line").attr("class","brushNoticeContinue brushNoticeContinue"+e+" graphContinue"+e).attr("y1",a.endPoint).attr("y2",a.startPoint).attr("x1",n(l[0])).attr("x2",n(l[0])),s.selectAll("*").on("mousemove",function(){var e=d3.mouse(this)[0];brushNoticeContinue(e,t)}),plotTaskMarks(t,e,taskInput,"Continue")}}function closestContinue(t,e){for(var a=e[0],n=Math.abs(t-a),r=0;r<e.length;r++){var o=Math.abs(t-e[r]);n>o&&(n=o,a=e[r])}return a}function brushNoticeContinue(t,e){for(var a,n,r,o,s,i=e.totalXRange,c=e.svg,l=e.stackedDataArr,d=0;d<l.length;d++){a=l[d].stackedData,n=l[d].xScale,r=l[d].yScale,o=l[d].startPoint,s=l[d].endPoint;var u=n.invert(t),p=closestContinue(u,i);c.selectAll(".AggregationPoint"+d+"-time-"+p).attr("r",6).transition(),c.selectAll(".brushNoticeContinue"+d).attr("x1",n(p)).attr("x2",n(p))}}function orderAndPartition(t,e,a,n){var r=t.stackedDataArr[a],o=r.xScale,s=r.yScale,i=(t.color,t.svg,t.height,t.stackProcess,t.totalXRange),c=r.stackedData,l=o.invert(e[0]+n.drag.x),d=s.invert(e[1]+n.drag.y);l=closestContinue(l,i);var u=i.indexOf(l);if(!(d<=n.values[u].display.y0+n.values[u].display.y&&d>n.values[u].display.y0)){if(0>=d){var p=Math.abs(1-a);t.stackedDataArr[a].stackedData=c.filter(function(t){return t.lineContent!=n.lineContent}),t.stackedDataArr[p].stackedData=findIndexForReorder(t.stackedDataArr[p].stackedData,-d,l,u,n)}else t.stackedDataArr[a].stackedData=findIndexForReorder(c,d,l,u,n);proporgateContinue(t);for(var y=0;y<t.stackedDataArr.length;y++)plotContinueStack(t,y)}}function proporgateContinue(t){(t.stackedDataArr[0].length=0)&&(t.stackedDataArr[0].stackedData=t.stackedDataArr[1].stackedData,t.stackedDataArr[1].stackedData=[])}function findIndexForReorder(t,e,a,n,r){t=t.filter(function(t){return t.lineContent!=r.lineContent});var o=t.map(function(t){var a=t.values[n].display;return a.y0<e&&e<=a.y+a.y0?1:-1}),s=o.indexOf(1);if(-1==s)t.push(r);else{var i=t.slice(0,s),c=t.slice(s);t=d3.merge([i,[r],c])}return t}function changeBase(t,e,a){var n=Math.abs(1-a),r=t.stackedDataArr[a].stackedData.slice(0,e),o=t.stackedDataArr[a].stackedData.slice(e);t.stackedDataArr[a].stackedData=o,t.stackedDataArr[n].stackedData=d3.merge([r.reverse(),t.stackedDataArr[n].stackedData]),proporgateContinue(t);for(var e=0;e<t.stackedDataArr.length;e++)plotContinueStack(t,e)}