function plotContinueStack(t,e){var a=t.stackedDataArr[e],n=a.xScale,r=a.yScale,s=t.color,c=t.svg,i=t.height,o=t.stackProcess,l=t.totalXRange,d=a.stackedData;if(c.selectAll(".continueStack"+e).remove(),0==d.length)return c.selectAll(".continueGraph"+e).remove(),void c.selectAll(".yAxisContinue"+e).remove();var u=d3.svg.area().interpolate(interpolate).x(function(t){return n(t.x)}).y0(function(t){return r(t.display.y0)}).y1(function(t){return r(t.display.y+t.display.y0)});d=o(d);var f=d3.behavior.drag().on("drag",function(t){t.drag.x+=d3.event.dx,t.drag.y+=d3.event.dy,d3.select(this).classed("unselected",!1).attr("transform",function(t){return"translate("+[t.drag.x,t.drag.y]+")"}),d3.event.sourceEvent.stopPropagation()}).on("dragend",function(a){orderAndPartition(t,d3.mouse(this),e,a),a.drag.x=0,a.drag.y=0});d3.selectAll(".yAxisContinue"+e).empty()&&c.append("g").attr("class","y axis yAxis yAxisContinue"+e).call(a.yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").text("Aggregation"),d3.selectAll(".xAxisContinue").empty()&&c.append("g").attr("class","x axis xAxis xAxisContinue").attr("transform","translate(0,"+i/2+")").call(a.xAxis),c.selectAll(".continueStack"+e).empty()?c.selectAll(".continueStack"+e).data(d).enter().append("path").attr("class",function(t){return"continueStack continueStack"+e+" continue-"+e+"-sequence-"+t.lineContent.slice(1)+" continueGraph"+e}):path.data(d).attr("class",function(t){return"continueStack continueStack"+e+" continue-"+e+"-sequence-"+t.lineContent.slice(1)+" continueGraph"+e}),c.selectAll(".continueStack"+e).attr("d",function(t){return u(t.values)}).style("fill",function(t){return s(t)}).on("mouseover",function(t){d3.selectAll(".continue-"+e+"-sequence-"+t.lineContent.slice(1)).classed("hover",!0)}).on("mouseout",function(t){d3.selectAll(".continue-"+e+"-sequence-"+t.lineContent.slice(1)).classed("hover",!1)}).on("dblclick",function(a,n){changeBase(t,n,e)}).call(f).append("title").text(function(t){return t.lineContent}),d3.selectAll(".brushNoticeContinue"+e).empty()&&c.append("line").attr("class","brushNoticeContinue brushNoticeContinue"+e+" graphContinue"+e).attr("y1",a.endPoint).attr("y2",a.startPoint).attr("x1",n(l[0])).attr("x2",n(l[0])),c.selectAll("*").on("mousemove",function(){var e=d3.mouse(this)[0];brushNoticeContinue(e,t)})}function closestContinue(t,e){for(var a=e[0],n=Math.abs(t-a),r=0;r<e.length;r++){var s=Math.abs(t-e[r]);n>s&&(n=s,a=e[r])}return a}function brushNoticeContinue(t,e){for(var a,n,r,s,c,i=e.totalXRange,o=e.svg,l=e.stackedDataArr,d=0;d<l.length;d++){a=l[d].stackedData,n=l[d].xScale,r=l[d].yScale,s=l[d].startPoint,c=l[d].endPoint;var u=n.invert(t),f=closestContinue(u,i);o.selectAll(".AggregationPoint"+d+"-time-"+f).attr("r",6).transition(),o.selectAll(".brushNoticeLine"+d).attr("x1",n(f)).attr("x2",n(f))}}function orderAndPartition(t,e,a,n){var r=t.stackedDataArr[a],s=r.xScale,c=r.yScale,i=(t.color,t.svg,t.height,t.stackProcess,t.totalXRange),o=r.stackedData,l=s.invert(e[0]+n.drag.x),d=c.invert(e[1]+n.drag.y);l=closestContinue(l,i);var u=i.indexOf(l);if(!(d<=n.values[u].display.y0+n.values[u].display.y&&d>n.values[u].display.y0)){if(0>=d){var f=Math.abs(1-a);t.stackedDataArr[a].stackedData=o.filter(function(t){return t.lineContent!=n.lineContent}),t.stackedDataArr[f].stackedData=findIndexForReorder(t.stackedDataArr[f].stackedData,-d,l,u,n)}else t.stackedDataArr[a].stackedData=findIndexForReorder(o,d,l,u,n);for(var v=0;v<t.stackedDataArr.length;v++)plotContinueStack(t,v)}}function findIndexForReorder(t,e,a,n,r){t=t.filter(function(t){return t.lineContent!=r.lineContent});var s=t.map(function(t){var a=t.values[n].display;return a.y0<e&&e<=a.y+a.y0?1:-1}),c=s.indexOf(1);if(-1==c)t.push(r);else{var i=t.slice(0,c),o=t.slice(c);t=d3.merge([i,[r],o])}return t}function changeBase(t,e,a){var n=Math.abs(1-a),r=t.stackedDataArr[a].stackedData.slice(0,e+1),s=t.stackedDataArr[a].stackedData.slice(e+1);t.stackedDataArr[a].stackedData=s,t.stackedDataArr[n].stackedData=d3.merge([r.reverse(),t.stackedDataArr[n].stackedData]);for(var e=0;e<t.stackedDataArr.length;e++)plotContinueStack(t,e)}